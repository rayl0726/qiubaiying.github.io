--- 
layout: post # 使用的布局（不需要改） 
title: http # 标题 
subtitle: http简单小结 #副标题 
date: 2018-06-27 # 时间 
author: rayl # 作者 
header-img: img/post-bg-2015.jpg #这篇文章标题背景图片 
catalog: true # 是否归档 
tags: #标签
    - study
    - 网络
---


近期专门重头学习了一遍http协议，记录一下学习的心得，以及以后忘记了再来查找。
# 关键词
1. MAC
2. ARP
3. URI
4. URL
5. RFC


# 1.简述TCP/IP
提到http就不得不提tcp/ip协议，我们通常使用的网络都是以tcp/ip为基础的，而http其实算是在其应用层使用的一个协议，所以先了解一下tcp/ip的分层结构：
![http1](https://raw.githubusercontent.com/rayl0726/rayl0726.github.io/master/img/http1.jpg)
从高到底分为应用层，传输层，网络层，链路层；
分层的设计结构可以模块化，便于自由设计；

## 1.1应用层
向用户提供应用服务的通信结构；
在该层主要存在：http，ftp，dns等
dns主要用于对域名解析为ip地址

## 1.2传输层
提供数据传输服务
该层主要存在：tcp，udp；
在tcp协议中将数据分为数据包进行传输，并且用了传说中的三次握手和四次分手的方式；

## 1.3网络层
传输数据包

该层主要存在：ip；

ip协议则利用了MAC可以中转传输;

## 1.4链路层
处理网络硬件相关

该层主要存在：操作系统，网卡，驱动，光纤等；

数据的传输是从发送端的高层到底层，接收端的底层到高层，每一层的数据在首部会封装关键字，便于解析识别。

# 2 HTTP协议
http协议是由客户端请求，服务端响应请求并返回，服务端在没有请求的情况下不会主动响应；

http协议是无状态协议，也就是传输的信息不会保存；
http协议通过uri定位资源；

http协议的连接在1.0中每次通信都要连接和断开一次，这种方式以不适用于当前的网络通信，所以在1.1中有了持久连接（keep-alive），也就是只要一方没有提出断开，则tcp连接将保持；

http协议本来是请求-响应后才能法下一个请求，但是有了持久连接，完全可以不等响应直接发送多个请求，而响应也可以依次返回；

http协议由于无状态，所以考虑一种情况：当我们登陆一个页面跳转后，我们在下一个页面如何保存登陆信息？这时出现了cookie技术，客户端请求，服务器端响应，并在响应报文首部中写入set-cookie信息；客户端再请求，请求报文首部中就有了上一次的cookie信息，服务器端响应，发现熟悉的cookie信息，就把之前的状态信息一并返回。

关于http/2.0，先得说说SPDY，这是一个谷歌开发的实验性协议，主要是想通过对http协议的限制作出优化，进而减少网页加载的时间，其目标大致分为：
* 页面加载时间降低50%；
* 无需网站作者修改任何内容；
* 把部署复杂性降低，不改变网络基础设施；

>SPDY通过优先级和多路复用，使得只需要建立一个TCP连接即可传送网页内容及图片等资源。SPDY中广泛应用了TLS加密，传输内容也均以gzip或DEFLATE格式压缩（与HTTP不同，HTTP的头部并不会被压缩）。另外，除了像HTTP的网页服务器被动的等待浏览器发起请求外，SPDY的网页服务器还可以主动推送内容。

>SPDY并不用于取代HTTP，它只是修改了HTTP的请求与应答在网络上传输的方式；这意味着只需增加一个SPDY传输层，现有的所有服务端应用均不用做任何修改。 当使用SPDY的方式传输，HTTP请求会被处理、标记简化和压缩。比如，每一个SPDY端点会持续跟踪每一个在之前的请求中已经发送的HTTP报文头部，从而避免重复发送还未改变的头部。而还未发送的报文的数据部分将在被压缩后被发送。

>2015年9月，Google 宣布了计划，移除对SPDY的支持，拥抱 HTTP/2.0，并将在Chrome 51中生效。

所以有了http/2.0，具体2.0版本的好处如下：

协议改进了对于报文的解析，采用二进制，这样只有0和1的组合将更加便捷和稳定；同时对于request采用共享连接诶的方式，在一个连接中可以存在多个request，每个都有自己的id，服务器端根据id可以分类到不同的请求；http是文本传输，根据结构其首部header部分的内容可能会非常多，传输起来很消耗资源，http/2.0可以压缩header，减少传输消耗；最后还有就是增加了server push功能。



# 3 HTTP报文结构
请求报文结构：
<table align="center"><tr><th>说明</th> <th colspan="6" >内容</th></tr><td>请求行</td><td>方法</td><td>sp</td><td>URI</td><td>sp</td><td>协议版本</td><td>CR+LF</td><tr><td>首部行</td><td colspan="2">首部字段名：</td><td>sp</td><td colspan="2">值</td><td>CR+LF</td></tr><tr><td colspan="7">CR+LF</td></tr><tr><td colspan="7">主体</td></tr></table>

响应报文结构：
<table align="center"><tr><th>说明</th> <th colspan="6">内容</th></tr><td>响应行</td><td>协议版本</td><td>sp</td><td>状态码</td><td>sp</td><td>状态信息</td><td>CR+LF</td><tr><td>首部行</td> <td colspan="2">首部字段名：</td><td>sp</td><td colspan="2">值</td><td>CR+LF</td></tr><tr><td colspan="7">CR+LF</td></tr><tr><td colspan="7">主体</td></tr></table>

# 4 HTTP请求方法
|版本|请求方法|
|----|----|
|HTTP/0.9|只存在一种GET方法，请求也只有GET www.google.com一行|
|HTTP/1.0|支持POST，GET，HEAD|
|HTTP/1.1|支持POST，GET，HEAD，新增五种：OPTIONS，PUT，DELETE，TRACE，CONNECT|
|HTTP/2.0|同HTTP/1.1|

|方法|描述|
|----|----|
|GET|请求获取指定资源，并返回主体。正常应该只用于数据的获取。|
|HEAD|请求一个与GET请求响应相同的响应，但是响应没有响应的主体。用于查看服务端的性能。|
|POST|向指定的资源提交数据，请求服务器的处理。用于表单提交，文件上传等，数据存在于请求的主体中。PS：post请求可能会对现有资源作出更改。|
|OPTIONS|用来查询针对请求URI指定资源支持的方法。|
|PUT|PUT方法用来传输文件，就像FTP协议的文件上传一样，要求在请求报文的主体中包含文件内容，然后保存在请求URI指定的位置。但是HTTP/1.1的PUT方法自身不带验证机制，任何人都可以上传文件，存在安全问题，故一般不用。|
|DELETE|指明客户端想让服务器删除某个资源，与PUT方法相反，按URI删除指定资源。|
|TRACE|客户端可以对请求消息的传输路径进行追踪，TRACE方法是让Web服务器端将之前的请求通信还给客户端的方法。|
|CONNECT|CONNECT方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL（安全套接层）和TLS（传输层安全）协议把通信内容加密后经网络隧道传输。|

由于GET和POST方法的使用个最为广泛，故对其作出对比：

1. GET方法用于信息获取，它是安全的（安全：指非修改信息，如数据库方面的信息），而POST方法是用于修改服务器上资源的请求；

2. GET请求的数据会附在URL之后，而POST方法提交的数据则放置在HTTP报文实体的主体里，所以POST方法的安全性比GET方法要高；

3. GET方法传输的数据量一般限制在2KB，其原因在于：GET是通过URL提交数据，而URL本身对于数据没有限制，但是不同的浏览器对于URL是有限制的，比如IE浏览器对于URL的限制为2KB，而Chrome，FireFox浏览器理论上对于URL是没有限制的，它真正的限制取决于操作系统本身；POST方法对于数据大小是无限制的，真正影响到数据大小的是服务器处理程序的能力。

# 5 HTTP状态码
## 5.1 1XX
信息性状态码，请求正在处理中

## 5.2 2XX
成功状态码，请求正常处理完毕
* 200 OK 请求正常处理；
* 204 No Content 请求成功，但是没有资源返回；
* 206 Partial Content 请求部分资源。

## 5.3 3XX
重定向状态码，需要附加操作完成请求
* 301 Moved Permanently 永久重定向，也就是资源的URI更新了，之前保存书签要更新了，永久性的，规定不能将请求POST改变为GET
* 302 Found 临时重定向，资源的URI更新了，但是以后可能还改变，规定不能将请求POST改变为GET
* 303 See Other 类似302，但应该使用GET方法请求
* 304 Not Modified 资源找到了，但是不符合附加条件
* 307 Temporary Redirect 临时重定向，且不会从POST变成GET

## 5.4 4XX
客户端错误状态码，服务器无法处理请求
* 400 Bad Request 请求报文语法错误
* 401 Unauthorized 表示请求需要通过认证（BASIC，DIGEST）首次会返回认证页面，以后默认认证失败
* 403 Forbidden 服务器拒绝访问
* 404 Not Found 服务器无法找到请求资源

## 5.5 5XX
服务端错误状态码，服务器端处理请求失败
* 500 Internal Server Error 服务器出现错误
* 503 Service Unavailable 服务器暂时超载或者停机维护

# 6 HTTP通信的服务器
http1.1支持但台服务器搭建多个站点，也就是不同的域名可能指向相同的ip地址；

http通信中可以存在转发的程序：代理，网关，隧道；

## 6.1 代理
简单来说就像一个中间人，将客户端的请求转发给服务器端，并把响应返回到客户端；

既然有了代理，如果只转发岂不是很浪费，于是有了：缓存代理，透明代理

### 6.1.1缓存代理
代理转发资源时，先把从源服务器端获得的资源缓存在服务器，下次再收到相同的请求时就直接返回缓存资源；

但是缓存是存在有效期的，长时间不更新肯定是不可以的，所以代理服务器会向原服务器求证缓存资源的有效性，若失效则重新获取；

缓存的资源除了存在代理服务器中，还可以存在客户端的磁盘中，效果一样，同样存在有效期。

### 6.1.2透明代理
不改变请求报文，响应报文的代理；

### 6.1.3不透明代理
改变请求报文，响应报文的代理;

## 6.2 网关
类似代理，但是它可以提供非http协议的通信，而且有高安全性，所以可以应用在购物结算等；

## 6.3 隧道
非常形象，将通信线路加密（ssl等），保证安全通信.

# 7 HTTP首部


参考文档：

[图解HTTP](https://book.douban.com/subject/25863515/)

[HTTP请求方法详解](https://www.cnblogs.com/foodoir/p/5911099.html)
         
[SPDY](https://zh.wikipedia.org/wiki/SPDY)